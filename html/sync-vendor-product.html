<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Dashboard - Multi-Platform</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background-color: #f8fafc;
      color: #1e293b;
      line-height: 1.5;
      padding: 0;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: white;
      min-height: 100vh;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.03);
    }

    /* Header Styles */
    .header {
      padding: 24px 32px;
      border-bottom: 1px solid #f1f5f9;
      background: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #0f172a;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header h1 i {
      font-size: 32px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-subtitle {
      color: #64748b;
      font-size: 15px;
      margin-top: 4px;
    }

    /* Platform Selector */
    .platform-selector {
      display: flex;
      gap: 8px;
      background: #f8fafc;
      padding: 4px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
    }

    .platform-btn {
      padding: 10px 24px;
      background: transparent;
      border: none;
      border-radius: 8px;
      color: #64748b;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .platform-btn:hover {
      background: rgba(255, 255, 255, 0.8);
      color: #475569;
    }

    .platform-btn.active {
      background: white;
      color: #6366f1;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
    }

    /* Top Bar */
    .top-bar {
      padding: 20px 32px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .search-box {
      flex: 1;
      min-width: 320px;
      position: relative;
    }

    .search-box input {
      width: 100%;
      padding: 14px 20px 14px 48px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      font-size: 15px;
      background: white;
      transition: all 0.2s;
      color: #1e293b;
    }

    .search-box input:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .search-box i {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
    }

    .action-buttons-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .action-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      color: #475569;
      transition: all 0.2s;
      position: relative;
    }

    .action-btn:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-1px);
    }

    .action-btn i {
      color: #6366f1;
    }

    /* FIXED: Filter Dropdown Styles */
    .filter-dropdown-container {
      position: relative;
    }

    .filter-dropdown-menu {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      z-index: 100;
      display: none;
      min-width: 260px;
      overflow: visible;
      animation: fadeIn 0.2s ease;
    }

    .filter-dropdown-container:hover .filter-dropdown-menu {
      display: block;
    }

    .filter-option {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.2s;
      color: #475569;
      font-size: 14px;
      border-bottom: 1px solid #f8fafc;
      position: relative;
    }

    .filter-option:last-child {
      border-bottom: none;
    }

    .filter-option:hover {
      background: #f1f5f9;
    }

    .filter-option.active {
      background: #f1f5f9;
      color: #6366f1;
    }

    .filter-option.active::after {
      content: " ✓";
      color: #6366f1;
      font-weight: bold;
    }

    .filter-chevron {
      font-size: 10px;
      color: #94a3b8;
      margin-left: 8px;
      transition: transform 0.2s;
    }

    .filter-option:hover .filter-chevron {
      color: #6366f1;
      transform: translateX(2px);
    }

    /* FIXED: Submenu with hover bridge */
    .filter-submenu {
      position: absolute;
      top: 0;
      left: 100%;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      min-width: 180px;
      display: none;
      z-index: 101;
      animation: fadeIn 0.2s ease;
      margin-left: 8px;
      /* Creates hover bridge */
    }

    /* Create an invisible hover bridge */
    .filter-option.has-submenu::after {
      content: '';
      position: absolute;
      top: 0;
      right: -8px;
      width: 16px;
      height: 100%;
      background: transparent;
    }

    .filter-option.has-submenu:hover .filter-submenu {
      display: block;
    }

    /* Keep submenu open when hovering over it */
    .filter-submenu:hover {
      display: block;
    }

    .filter-submenu-option {
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.2s;
      color: #475569;
      font-size: 14px;
      border-bottom: 1px solid #f8fafc;
    }

    .filter-submenu-option:last-child {
      border-bottom: none;
    }

    .filter-submenu-option:hover {
      background: #f1f5f9;
    }

    .filter-submenu-option.active {
      background: #f1f5f9;
      color: #6366f1;
    }

    .filter-submenu-option.active::after {
      content: " ✓";
      color: #6366f1;
      font-weight: bold;
    }

    .active-filters-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      font-size: 11px;
      font-weight: 600;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Bulk Actions Dropdown */
    .bulk-actions-container {
      position: relative;
    }

    .bulk-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      margin-top: 8px;
      z-index: 100;
      display: none;
      min-width: 260px;
      overflow: hidden;
    }

    .bulk-dropdown.show {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    .bulk-group {
      padding: 8px 0;
    }

    .bulk-group-header {
      padding: 10px 16px;
      font-size: 12px;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      background: #f8fafc;
    }

    .bulk-option {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: background 0.2s;
      color: #475569;
      font-size: 14px;
    }

    .bulk-option:hover {
      background: #f1f5f9;
    }

    .bulk-option i {
      width: 20px;
      color: #64748b;
    }

    .bulk-option.delete {
      color: #ef4444;
    }

    .bulk-option.delete i {
      color: #ef4444;
    }

    /* Product Table */
    .table-container {
      padding: 0 32px 32px;
      overflow-x: auto;
    }

    .no-products {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
      font-size: 16px;
    }

    .no-products i {
      font-size: 48px;
      margin-bottom: 16px;
      color: #cbd5e1;
    }

    .product-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }

    .table-header {
      background: #f8fafc;
    }

    .table-header th {
      padding: 18px 16px;
      text-align: left;
      font-weight: 600;
      color: #64748b;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid #e2e8f0;
      white-space: nowrap;
    }

    .table-header th:first-child {
      border-radius: 10px 0 0 0;
    }

    .table-header th:last-child {
      border-radius: 0 10px 0 0;
    }

    .product-row {
      border-bottom: 1px solid #f1f5f9;
      transition: all 0.2s;
      cursor: pointer;
    }

    .product-row:hover {
      background: #f8fafc;
    }

    .product-row.expanded {
      background: #f8fafc;
      border-bottom: none;
    }

    .product-row.hidden {
      display: none;
    }

    .product-row td {
      padding: 20px 16px;
      vertical-align: middle;
    }

    .product-image {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      background: white;
    }

    .product-info {
      max-width: 300px;
    }

    .product-title {
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
    }

    .product-title i {
      color: #6366f1;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.3s;
    }

    .product-category {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }

    .product-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      background: #e0f2fe;
      color: #0369a1;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .tag.featured {
      background: #fef3c7;
      color: #92400e;
    }

    .tag.platform {
      background: #e0e7ff;
      color: #3730a3;
    }

    .status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-active {
      background: #d1fae5;
      color: #065f46;
    }

    .status-inactive {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-private {
      background: #ede9fe;
      color: #5b21b6;
    }

    .status-rejected {
      background: #fee2e2;
      color: #991b1b;
    }

    .mapping-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: inline-block;
    }

    .mapped {
      background: #d1fae5;
      color: #065f46;
    }

    .unmapped {
      background: #fee2e2;
      color: #991b1b;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .action-btn-icon {
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: #f1f5f9;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-size: 16px;
    }

    .action-btn-icon:hover {
      background: #e2e8f0;
      color: #475569;
    }

    .action-btn-icon.copy-link:hover {
      background: #3b82f6;
      color: white;
    }

    .action-btn-icon.delete-btn:hover {
      background: #ef4444;
      color: white;
    }

    /* Checkbox Styling */
    .checkbox-container {
      position: relative;
    }

    .checkbox-container input[type="checkbox"] {
      width: 20px;
      height: 20px;
      border-radius: 6px;
      border: 2px solid #cbd5e1;
      appearance: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .checkbox-container input[type="checkbox"]:checked {
      background: #6366f1;
      border-color: #6366f1;
    }

    .checkbox-container input[type="checkbox"]:checked:after {
      content: "✓";
      color: white;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 12px;
      font-weight: bold;
    }

    /* Expanded Variant Section */
    .expanded-variant-section {
      display: none;
      padding: 0;
      background: #f8fafc;
    }

    .expanded-variant-section.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
      }

      to {
        opacity: 1;
        max-height: 1000px;
      }
    }

    .expanded-variant-content {
      padding: 24px;
      background: white;
      border-radius: 12px;
      margin: 0 16px 16px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
    }

    .expanded-variant-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #f1f5f9;
      flex-wrap: wrap;
      gap: 16px;
    }

    .expanded-variant-header h3 {
      font-size: 18px;
      font-weight: 600;
      color: #0f172a;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .expanded-variant-header h3 i {
      color: #6366f1;
      font-size: 20px;
    }

    .variant-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .variant-action-btn {
      padding: 10px 18px;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      color: #475569;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .variant-action-btn:hover {
      background: #e2e8f0;
      transform: translateY(-1px);
    }

    .variant-action-btn.primary {
      background: #6366f1;
      color: white;
      border-color: #6366f1;
    }

    .variant-action-btn.primary:hover {
      background: #4f46e5;
    }

    .variant-action-btn.warning {
      background: #f59e0b;
      color: white;
      border-color: #f59e0b;
    }

    .variant-action-btn.warning:hover {
      background: #d97706;
    }

    /* Variant Table */
    .variant-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #f1f5f9;
    }

    .variant-table th {
      padding: 16px;
      text-align: left;
      font-weight: 600;
      color: #64748b;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }

    .variant-table td {
      padding: 18px 16px;
      border-bottom: 1px solid #f8fafc;
    }

    .variant-table tr:last-child td {
      border-bottom: none;
    }

    .variant-table tr:hover td {
      background: #f8fafc;
    }

    .variant-image {
      width: 56px;
      height: 56px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      background: white;
    }

    .variant-image-placeholder {
      width: 56px;
      height: 56px;
      border-radius: 8px;
      background: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #94a3b8;
      border: 1px dashed #cbd5e1;
      font-size: 20px;
    }

    .image-upload-cell {
      position: relative;
    }

    .upload-image-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 12px;
      color: #475569;
      cursor: pointer;
      opacity: 0;
      transition: all 0.2s;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .image-upload-cell:hover .upload-image-btn {
      opacity: 1;
    }

    .input-field {
      padding: 10px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      transition: all 0.2s;
      width: 100%;
      max-width: 140px;
    }

    .input-field:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .variant-number {
      font-weight: 600;
      color: #6366f1;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: #e0e7ff;
      border-radius: 8px;
    }

    .variant-actions-cell {
      display: flex;
      gap: 8px;
    }

    .variant-action-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: #f1f5f9;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-size: 15px;
    }

    .variant-action-icon:hover {
      background: #e2e8f0;
      color: #475569;
    }

    .variant-action-icon.primary:hover {
      background: #6366f1;
      color: white;
    }

    .variant-action-icon.warning:hover {
      background: #f59e0b;
      color: white;
    }

    .variant-action-icon.delete-variant-btn:hover {
      background: #ef4444;
      color: white;
    }

    /* Image Upload Modal */
    .image-upload-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .image-upload-modal.show {
      display: flex;
      animation: fadeInModal 0.3s ease;
    }

    @keyframes fadeInModal {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .image-upload-content {
      background: white;
      border-radius: 16px;
      padding: 32px;
      width: 100%;
      max-width: 520px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .image-upload-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #f1f5f9;
    }

    .image-upload-header h3 {
      color: #0f172a;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 28px;
      color: #94a3b8;
      cursor: pointer;
      transition: color 0.2s;
      line-height: 1;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }

    .close-modal:hover {
      color: #ef4444;
      background: #fef2f2;
    }

    .image-preview-container {
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      margin-bottom: 24px;
      background: #f8fafc;
      min-height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      cursor: pointer;
      transition: all 0.2s;
    }

    .image-preview-container:hover {
      border-color: #6366f1;
      background: #f1f5f9;
    }

    .image-preview {
      max-width: 100%;
      max-height: 200px;
      border-radius: 8px;
      display: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .upload-placeholder {
      color: #64748b;
      font-size: 16px;
    }

    .upload-placeholder i {
      font-size: 56px;
      margin-bottom: 16px;
      color: #94a3b8;
    }

    .upload-actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .upload-btn {
      padding: 14px 24px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      flex: 1;
      transition: all 0.2s;
      font-size: 15px;
    }

    .upload-btn.primary {
      background: #6366f1;
      color: white;
    }

    .upload-btn.primary:hover {
      background: #4f46e5;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .upload-btn.secondary {
      background: #f1f5f9;
      color: #475569;
    }

    .upload-btn.secondary:hover {
      background: #e2e8f0;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 16px 20px;
      background: #0f172a;
      color: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 360px;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      background: #10b981;
    }

    .toast.error {
      background: #ef4444;
    }

    .toast.warning {
      background: #f59e0b;
    }

    .toast i {
      font-size: 20px;
    }

    /* Active Filters Display */
    .active-filters-container {
      padding: 16px 32px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .active-filter-tag {
      background: #e0e7ff;
      color: #3730a3;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .active-filter-tag .remove-filter {
      background: none;
      border: none;
      color: #3730a3;
      cursor: pointer;
      font-size: 14px;
      padding: 0;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .active-filter-tag .remove-filter:hover {
      background: #c7d2fe;
    }

    .clear-all-filters {
      background: none;
      border: none;
      color: #64748b;
      font-size: 13px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .clear-all-filters:hover {
      background: #f1f5f9;
      color: #475569;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .container {
        border-radius: 0;
      }

      .top-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .search-box {
        min-width: 100%;
      }
    }

    @media (max-width: 768px) {

      .header,
      .top-bar,
      .table-container,
      .active-filters-container {
        padding: 20px 16px;
      }

      .table-header th,
      .product-row td {
        padding: 14px 12px;
      }

      .expanded-variant-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      .variant-actions {
        width: 100%;
      }

      .variant-action-btn {
        flex: 1;
        justify-content: center;
        min-width: 140px;
      }

      .variant-table {
        font-size: 14px;
      }

      .variant-table th,
      .variant-table td {
        padding: 14px 12px;
      }

      .image-upload-content {
        padding: 24px 20px;
      }

      .upload-actions {
        flex-direction: column;
      }

      .filter-dropdown-menu {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        min-width: 90vw;
        max-height: 80vh;
        overflow-y: auto;
      }

      .filter-submenu {
        position: static;
        display: none;
        background: #f8fafc;
        border: none;
        box-shadow: none;
        border-radius: 0;
        margin-top: 8px;
        margin-left: 0;
        width: 100%;
      }

      .filter-option.has-submenu::after {
        display: none;
      }
    }

    @media (max-width: 480px) {
      .header h1 {
        font-size: 24px;
      }

      .platform-selector {
        flex-wrap: wrap;
      }

      .action-buttons-container {
        flex-direction: column;
        width: 100%;
      }

      .action-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header with Platform Selection -->
    <div class="header">
      <div class="header-left">
        <h1><i class="fas fa-cube"></i> Product Dashboard</h1>
        <div class="header-subtitle">Manage products across multiple platforms</div>
      </div>

      <div class="platform-selector">
        <div class="platform-btn active" data-platform="shopify">
          <i class="fab fa-shopify"></i> Shopify
        </div>
        <div class="platform-btn" data-platform="wix">
          <i class="fas fa-store"></i> Wix
        </div>
        <div class="platform-btn" data-platform="woocommerce">
          <i class="fab fa-wordpress"></i> WooCommerce
        </div>
      </div>
    </div>

    <!-- Top Bar with Controls -->
    <div class="top-bar">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search products, variants, SKUs...">
      </div>

      <div class="action-buttons-container">
        <!-- FIXED: Filter Dropdown -->
        <div class="filter-dropdown-container">
          <div class="action-btn" id="filtersBtn">
            <i class="fas fa-sliders-h"></i>
            <span>Filters</span>
            <div class="active-filters-badge" id="activeFiltersBadge" style="display: none;">0</div>
          </div>

          <div class="filter-dropdown-menu" id="filterDropdown">
            <!-- PRODUCT STATUS -->
            <div class="filter-option main-filter has-submenu" data-filter="status">
              <span class="filter-option-text">Product Status</span>
              <i class="fas fa-chevron-right filter-chevron"></i>

              <div class="filter-submenu">
                <div class="filter-submenu-option" data-filter="status" data-value="all">
                  All Status
                </div>
                <div class="filter-submenu-option" data-filter="status" data-value="active">
                  Active
                </div>
                <div class="filter-submenu-option" data-filter="status" data-value="pending">
                  Pending
                </div>
                <div class="filter-submenu-option" data-filter="status" data-value="private">
                  Private
                </div>
                <div class="filter-submenu-option" data-filter="status" data-value="rejected">
                  Rejected
                </div>
              </div>
            </div>

            <!-- MAPPING STATUS -->
            <div class="filter-option main-filter has-submenu" data-filter="mapping">
              <span class="filter-option-text">Mapping Status</span>
              <i class="fas fa-chevron-right filter-chevron"></i>

              <div class="filter-submenu">
                <div class="filter-submenu-option" data-filter="mapping" data-value="all">
                  All
                </div>
                <div class="filter-submenu-option" data-filter="mapping" data-value="mapped">
                  Mapped
                </div>
                <div class="filter-submenu-option" data-filter="mapping" data-value="unmapped">
                  Unmapped
                </div>
              </div>
            </div>

            <!-- STOCK STATUS -->
            <div class="filter-option main-filter has-submenu" data-filter="stock">
              <span class="filter-option-text">Stock Status</span>
              <i class="fas fa-chevron-right filter-chevron"></i>

              <div class="filter-submenu">
                <div class="filter-submenu-option" data-filter="stock" data-value="all">
                  All Stock
                </div>
                <div class="filter-submenu-option" data-filter="stock" data-value="in-stock">
                  In Stock
                </div>
                <div class="filter-submenu-option" data-filter="stock" data-value="out-of-stock">
                  Out of Stock
                </div>
                <div class="filter-submenu-option" data-filter="stock" data-value="low-stock">
                  Low Stock
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bulk Actions with Dropdown -->
        <div class="bulk-actions-container">
          <div class="action-btn" id="bulkActionsBtn">
            <i class="fas fa-tasks"></i>
            <span>Bulk Actions</span>
            <i class="fas fa-chevron-down" style="font-size: 12px;"></i>
          </div>

          <div class="bulk-dropdown" id="bulkDropdown">
            <div class="bulk-group">
              <div class="bulk-group-header">Product Status</div>
              <div class="bulk-option" data-action="set-active">
                <i class="fas fa-check-circle"></i>
                <span>Set Active</span>
              </div>
              <div class="bulk-option" data-action="set-pending">
                <i class="fas fa-clock"></i>
                <span>Set Pending</span>
              </div>
              <div class="bulk-option" data-action="set-private">
                <i class="fas fa-lock"></i>
                <span>Set Private</span>
              </div>
              <div class="bulk-option" data-action="set-rejected">
                <i class="fas fa-times-circle"></i>
                <span>Set Rejected</span>
              </div>
            </div>

            <div class="bulk-group">
              <div class="bulk-group-header">Danger Zone</div>
              <div class="bulk-option delete" data-action="delete">
                <i class="fas fa-trash"></i>
                <span>Delete Selected</span>
              </div>
            </div>
          </div>
        </div>

        <div class="action-btn" id="refreshBtn">
          <i class="fas fa-redo-alt"></i>
          <span>Refresh</span>
        </div>
      </div>
    </div>

    <!-- Active Filters Display -->
    <div class="active-filters-container" id="activeFiltersContainer">
      <!-- Active filters will appear here -->
    </div>

    <!-- Main Product Table -->
    <div class="table-container">
      <table class="product-table">
        <thead class="table-header">
          <tr>
            <th style="width: 50px;">
              <div class="checkbox-container">
                <input type="checkbox" id="select-all">
              </div>
            </th>
            <th>Product</th>
            <th>Details</th>
            <th>Status</th>
            <th>Stock</th>
            <th>Mapping</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="productTableBody">
          <!-- Products will be dynamically inserted here -->
        </tbody>
      </table>
      <div id="noProductsMessage" class="no-products" style="display: none;">
        <i class="fas fa-box-open"></i>
        <h3>No products found</h3>
        <p>Try adjusting your search or filter criteria</p>
      </div>
    </div>
  </div>

  <!-- Image Upload Modal -->
  <div class="image-upload-modal" id="imageUploadModal">
    <div class="image-upload-content">
      <div class="image-upload-header">
        <h3><i class="fas fa-image"></i> Upload Variant Image</h3>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>

      <div class="image-preview-container" id="imagePreviewContainer">
        <div class="upload-placeholder" id="uploadPlaceholder">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>Click to upload or drag and drop</p>
          <p style="font-size: 13px; margin-top: 8px; color: #94a3b8;">PNG, JPG, GIF up to 5MB</p>
        </div>
        <img src="" alt="Preview" class="image-preview" id="imagePreview">
      </div>

      <input type="file" id="imageUploadInput" accept="image/*" style="display: none;">

      <div class="upload-actions">
        <button class="upload-btn secondary" id="cancelUpload">Cancel</button>
        <button class="upload-btn primary" id="uploadImage">Upload Image</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage">Operation completed successfully!</span>
  </div>

  <!-- JavaScript with Complete Functionality -->
  <script>
    // Sample product data for different platforms
    const productsData = {
      shopify: [
        {
          id: 1,
          title: "Beauty and the Boast-Victorian Fairy Tale Watch",
          category: "Watch Collection",
          tags: ["Fairy Tale", "Victorian", "Luxury", "Shopify"],
          image: "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80",
          status: "active",
          stock: 12,
          mapping: "unmapped",
          platform: "shopify",
          variants: [
            {
              id: 1,
              title: "39 mm Silver Case",
              description: "Silver Case, Leather Strap",
              image: "https://images.unsplash.com/photo-1547996160-81bc1a7b3d71?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "SHOP-WATCH-SILVER",
              weight: "0.5 Pounds",
              price: "£175.00",
              quantity: 8,
              mapping: "unmapped"
            },
            {
              id: 2,
              title: "36 mm Gold Case",
              description: "Gold Case, Leather Strap",
              image: "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "SHOP-WATCH-GOLD",
              weight: "0.5 Pounds",
              price: "£195.00",
              quantity: 4,
              mapping: "mapped"
            }
          ]
        },
        {
          id: 2,
          title: "Vintage Leather Headphones",
          category: "Audio & Sound",
          tags: ["Vintage", "Leather", "Premium", "Featured", "Shopify"],
          image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80",
          status: "active",
          stock: 25,
          mapping: "mapped",
          platform: "shopify",
          variants: [
            {
              id: 1,
              title: "Black Leather",
              description: "Over-ear, Noise Cancelling",
              image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "SHOP-HPH-VNT-BLK",
              weight: "1.2 Pounds",
              price: "£89.99",
              quantity: 15,
              mapping: "mapped"
            },
            {
              id: 2,
              title: "Brown Leather",
              description: "Over-ear, Noise Cancelling",
              image: "https://images.unsplash.com/photo-1583394838336-acd977736f90?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "SHOP-HPH-VNT-BRN",
              weight: "1.2 Pounds",
              price: "£94.99",
              quantity: 10,
              mapping: "mapped"
            }
          ]
        },
        {
          id: 3,
          title: "Wireless Bluetooth Earbuds",
          category: "Audio & Sound",
          tags: ["Wireless", "Bluetooth", "Noise Cancelling", "Shopify"],
          image: "https://images.unsplash.com/photo-1590658165737-15a047b8b5e6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80",
          status: "pending",
          stock: 5,
          mapping: "unmapped",
          platform: "shopify",
          variants: [
            {
              id: 1,
              title: "Black",
              description: "Wireless, Noise Cancelling",
              image: "https://images.unsplash.com/photo-1590658165737-15a047b8b5e6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "SHOP-EBD-BLK-01",
              weight: "0.3 Pounds",
              price: "£129.99",
              quantity: 5,
              mapping: "unmapped"
            }
          ]
        }
      ],
      wix: [
        {
          id: 4,
          title: "Premium Coffee Maker",
          category: "Home & Kitchen",
          tags: ["Premium", "Automatic", "Programmable", "Wix"],
          image: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80",
          status: "private",
          stock: 0,
          mapping: "mapped",
          platform: "wix",
          variants: [
            {
              id: 1,
              title: "Stainless Steel",
              description: "12-cup Programmable",
              image: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WIX-CFM-STL-12",
              weight: "8.5 Pounds",
              price: "£199.99",
              quantity: 0,
              mapping: "mapped"
            }
          ]
        },
        {
          id: 5,
          title: "Smart Fitness Watch",
          category: "Wearables",
          tags: ["Smart", "Fitness", "Health", "Wix"],
          image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80",
          status: "active",
          stock: 18,
          mapping: "unmapped",
          platform: "wix",
          variants: [
            {
              id: 1,
              title: "Black, 44mm",
              description: "GPS, Heart Rate Monitor",
              image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WIX-WATCH-BLK-44",
              weight: "0.3 Pounds",
              price: "£249.99",
              quantity: 12,
              mapping: "unmapped"
            },
            {
              id: 2,
              title: "Silver, 40mm",
              description: "GPS, Heart Rate Monitor",
              image: "https://images.unsplash.com/photo-1579586337278-3f9d2c6c1c3e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WIX-WATCH-SIL-40",
              weight: "0.3 Pounds",
              price: "£239.99",
              quantity: 6,
              mapping: "mapped"
            }
          ]
        }
      ],
      woocommerce: [
        {
          id: 6,
          title: "Ergonomic Office Chair",
          category: "Office Furniture",
          tags: ["Ergonomic", "Office", "Comfort", "WooCommerce"],
          image: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80",
          status: "active",
          stock: 7,
          mapping: "mapped",
          platform: "woocommerce",
          variants: [
            {
              id: 1,
              title: "Black Mesh",
              description: "Adjustable height, lumbar support",
              image: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WOO-CHAIR-BLK-MSH",
              weight: "25.0 Pounds",
              price: "£299.99",
              quantity: 4,
              mapping: "mapped"
            },
            {
              id: 2,
              title: "Gray Fabric",
              description: "Adjustable height, lumbar support",
              image: "https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WOO-CHAIR-GRY-FAB",
              weight: "26.0 Pounds",
              price: "£329.99",
              quantity: 3,
              mapping: "unmapped"
            }
          ]
        },
        {
          id: 7,
          title: "Organic Cotton T-Shirt",
          category: "Apparel",
          tags: ["Organic", "Cotton", "Sustainable", "WooCommerce"],
          image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80",
          status: "pending",
          stock: 32,
          mapping: "unmapped",
          platform: "woocommerce",
          variants: [
            {
              id: 1,
              title: "Small, White",
              description: "100% Organic Cotton",
              image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WOO-TSHT-S-WHT",
              weight: "0.4 Pounds",
              price: "£24.99",
              quantity: 10,
              mapping: "unmapped"
            },
            {
              id: 2,
              title: "Medium, White",
              description: "100% Organic Cotton",
              image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WOO-TSHT-M-WHT",
              weight: "0.4 Pounds",
              price: "£24.99",
              quantity: 12,
              mapping: "unmapped"
            },
            {
              id: 3,
              title: "Large, White",
              description: "100% Organic Cotton",
              image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=80&q=80",
              sku: "WOO-TSHT-L-WHT",
              weight: "0.4 Pounds",
              price: "£24.99",
              quantity: 10,
              mapping: "unmapped"
            }
          ]
        }
      ]
    };

    // State management
    let currentPlatform = 'shopify';
    let products = [...productsData[currentPlatform]];
    let filters = {
      status: 'all',
      mapping: 'all',
      stock: 'all',
      search: ''
    };

    // Image upload variables
    let currentProductId = null;
    let currentVariantId = null;

    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', function () {
      renderProducts();
      renderActiveFilters();
      initializeEventListeners();
      initializeImageUpload();
      updateFilterUI(); // Initialize filter UI

      // Add click handler for filters button (for touch devices)
      document.getElementById('filtersBtn').addEventListener('click', function (e) {
        e.stopPropagation();
        const dropdown = document.getElementById('filterDropdown');
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function (e) {
        if (!e.target.closest('.filter-dropdown-container')) {
          const dropdown = document.getElementById('filterDropdown');
          if (window.innerWidth > 768) {
            dropdown.style.display = 'none';
          }
        }
      });
    });

    // Render products to the table
    function renderProducts() {
      const tableBody = document.getElementById('productTableBody');
      const noProductsMessage = document.getElementById('noProductsMessage');

      // Filter products based on current filters
      const filteredProducts = filterProducts(products);

      if (filteredProducts.length === 0) {
        tableBody.innerHTML = '';
        noProductsMessage.style.display = 'block';
        return;
      }

      noProductsMessage.style.display = 'none';
      tableBody.innerHTML = '';

      filteredProducts.forEach(product => {
        // Product row
        const productRow = document.createElement('tr');
        productRow.className = 'product-row';
        productRow.dataset.productId = product.id;

        productRow.innerHTML = `
                    <td>
                        <div class="checkbox-container">
                            <input type="checkbox" class="product-checkbox" data-product-id="${product.id}">
                        </div>
                    </td>
                    <td>
                        <div class="product-info">
                            <div class="product-title">
                                ${product.title}
                                <i class="fas fa-chevron-right arrow-icon"></i>
                            </div>
                            <div class="product-category">${product.category}</div>
                            <div class="product-tags">
                                ${product.tags.map(tag => `
                                    <span class="tag ${tag === 'Featured' ? 'featured' : (tag === 'Shopify' || tag === 'Wix' || tag === 'WooCommerce') ? 'platform' : ''}">${tag}</span>
                                `).join('')}
                            </div>
                        </div>
                    </td>
                    <td>
                        <img src="${product.image}" alt="Product" class="product-image">
                    </td>
                    <td>
                        <span class="status status-${product.status}">
                            <i class="fas fa-circle" style="font-size: 8px;"></i>
                            ${capitalizeFirstLetter(product.status)}
                        </span>
                    </td>
                    <td>
                        <div style="font-weight: 600; color: #0f172a;">${product.stock}</div>
                        <div style="font-size: 13px; color: #64748b;">In Stock</div>
                    </td>
                    <td>
                        <span class="mapping-status ${product.mapping}">${capitalizeFirstLetter(product.mapping)}</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn-icon copy-link" title="Copy Link" data-product-id="${product.id}">
                                <i class="fas fa-link"></i>
                            </button>
                            <button class="action-btn-icon delete-btn" title="Delete" data-product-id="${product.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;

        tableBody.appendChild(productRow);

        // Variant section row
        const variantRow = document.createElement('tr');
        variantRow.className = 'variant-section-row';

        variantRow.innerHTML = `
                    <td colspan="7">
                        <div class="expanded-variant-section" id="variant-section-${product.id}">
                            <div class="expanded-variant-content">
                                <div class="expanded-variant-header">
                                    <h3><i class="fas fa-layer-group"></i> Variant Management</h3>
                                    <div class="variant-actions">
                                        <button class="variant-action-btn primary add-variant-btn" data-product-id="${product.id}">
                                            <i class="fas fa-plus"></i> Add Variant
                                        </button>
                                        <button class="variant-action-btn sync-all-variants-btn" data-product-id="${product.id}">
                                            <i class="fas fa-sync-alt"></i> Sync All
                                        </button>
                                        <button class="variant-action-btn map-all-variants-btn" data-product-id="${product.id}">
                                            <i class="fas fa-map-marker-alt"></i> Map All
                                        </button>
                                        <button class="variant-action-btn primary save-variants-btn" data-product-id="${product.id}">
                                            <i class="fas fa-save"></i> Save Changes
                                        </button>
                                    </div>
                                </div>
                                <table class="variant-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 50px;">#</th>
                                            <th style="width: 100px;">Image</th>
                                            <th>Variant Details</th>
                                            <th style="width: 150px;">SKU</th>
                                            <th style="width: 120px;">Weight</th>
                                            <th style="width: 120px;">Price</th>
                                            <th style="width: 100px;">Quantity</th>
                                            <th style="width: 130px;">Mapping</th>
                                            <th style="width: 180px;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="variant-table-${product.id}">
                                        ${product.variants.map((variant, index) => `
                                            <tr>
                                                <td>
                                                    <div class="variant-number">${index + 1}</div>
                                                </td>
                                                <td class="image-upload-cell">
                                                    ${variant.image ? `
                                                        <img src="${variant.image}" alt="Variant" class="variant-image">
                                                    ` : `
                                                        <div class="variant-image-placeholder">
                                                            <i class="fas fa-image"></i>
                                                        </div>
                                                    `}
                                                    <button class="upload-image-btn" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                        <i class="fas fa-camera"></i> ${variant.image ? 'Change' : 'Add Image'}
                                                    </button>
                                                </td>
                                                <td>
                                                    <strong>${variant.title}</strong>
                                                    <div style="font-size: 13px; color: #64748b; margin-top: 4px;">${variant.description}</div>
                                                </td>
                                                <td>
                                                    <input type="text" class="input-field sku-input" placeholder="Enter SKU" 
                                                        value="${variant.sku}" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                </td>
                                                <td>
                                                    <input type="text" class="input-field weight-input" 
                                                        value="${variant.weight}" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                </td>
                                                <td>
                                                    <input type="text" class="input-field price-input" 
                                                        value="${variant.price}" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                </td>
                                                <td>
                                                    <input type="number" class="input-field quantity-input" 
                                                        value="${variant.quantity}" min="0" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                </td>
                                                <td>
                                                    <span class="mapping-status ${variant.mapping}">${capitalizeFirstLetter(variant.mapping)}</span>
                                                </td>
                                                <td>
                                                    <div class="variant-actions-cell">
                                                        <button class="variant-action-icon primary map-variant-btn" 
                                                            title="Map Variant" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                            <i class="fas fa-map-marker-alt"></i>
                                                        </button>
                                                        <button class="variant-action-icon warning sync-variant-btn" 
                                                            title="Sync Variant" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                            <i class="fas fa-sync-alt"></i>
                                                        </button>
                                                        <button class="variant-action-icon delete-variant-btn" 
                                                            title="Delete Variant" data-product-id="${product.id}" data-variant-id="${variant.id}">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </td>
                `;

        tableBody.appendChild(variantRow);
      });

      // Re-attach event listeners
      attachProductRowListeners();
      attachVariantListeners();
      attachImageUploadListeners();
    }

    // Render active filters display
    function renderActiveFilters() {
      const activeFiltersContainer = document.getElementById('activeFiltersContainer');
      const activeFiltersBadge = document.getElementById('activeFiltersBadge');

      // Count active filters (excluding 'all' values)
      let activeFilterCount = 0;
      let activeFiltersHTML = '';

      Object.keys(filters).forEach(filterType => {
        if (filterType !== 'search' && filters[filterType] !== 'all') {
          activeFilterCount++;

          let displayText = '';
          let displayValue = '';

          switch (filterType) {
            case 'status':
              displayText = 'Status';
              displayValue = capitalizeFirstLetter(filters[filterType]);
              break;
            case 'mapping':
              displayText = 'Mapping';
              displayValue = capitalizeFirstLetter(filters[filterType]);
              break;
            case 'stock':
              displayText = 'Stock';
              displayValue = filters[filterType] === 'in-stock' ? 'In Stock' :
                filters[filterType] === 'out-of-stock' ? 'Out of Stock' :
                  filters[filterType] === 'low-stock' ? 'Low Stock' :
                    filters[filterType];
              break;
          }

          if (displayValue) {
            activeFiltersHTML += `
                            <div class="active-filter-tag">
                                <span>${displayText}: ${displayValue}</span>
                                <button class="remove-filter" data-filter-type="${filterType}">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
          }
        }
      });

      // Update badge
      if (activeFilterCount > 0) {
        activeFiltersBadge.textContent = activeFilterCount;
        activeFiltersBadge.style.display = 'flex';
      } else {
        activeFiltersBadge.style.display = 'none';
      }

      // Update active filters display
      if (activeFiltersHTML) {
        activeFiltersContainer.innerHTML = activeFiltersHTML + `
                    <button class="clear-all-filters" id="clearAllFilters">
                        Clear all
                    </button>
                `;

        // Add event listeners to remove filter buttons
        document.querySelectorAll('.remove-filter').forEach(btn => {
          btn.addEventListener('click', function () {
            const filterType = this.dataset.filterType;
            filters[filterType] = 'all';
            updateFilterUI();
            renderProducts();
            renderActiveFilters();
          });
        });

        // Add event listener to clear all filters
        document.getElementById('clearAllFilters').addEventListener('click', function () {
          filters = {
            status: 'all',
            mapping: 'all',
            stock: 'all',
            search: document.getElementById('searchInput').value.trim()
          };

          updateFilterUI();
          renderProducts();
          renderActiveFilters();
        });

        activeFiltersContainer.style.display = 'flex';
      } else {
        activeFiltersContainer.style.display = 'none';
      }
    }

    // Update filter UI to reflect current filter states
    function updateFilterUI() {
      // Update all filter submenu options
      document.querySelectorAll('.filter-submenu-option').forEach(option => {
        const filterType = option.dataset.filter;
        const value = option.dataset.value;

        if (filters[filterType] === value) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });

      // Update main filter options (show which one is selected)
      document.querySelectorAll('.main-filter').forEach(filter => {
        const filterType = filter.dataset.filter;
        if (filters[filterType] !== 'all') {
          filter.classList.add('active');
        } else {
          filter.classList.remove('active');
        }
      });
    }

    // Filter products based on current filters
    function filterProducts(products) {
      return products.filter(product => {
        // Search filter
        if (filters.search) {
          const searchLower = filters.search.toLowerCase();
          const matchesSearch =
            product.title.toLowerCase().includes(searchLower) ||
            product.category.toLowerCase().includes(searchLower) ||
            product.tags.some(tag => tag.toLowerCase().includes(searchLower)) ||
            product.variants.some(variant =>
              variant.title.toLowerCase().includes(searchLower) ||
              variant.sku.toLowerCase().includes(searchLower)
            );

          if (!matchesSearch) return false;
        }

        // Status filter
        if (filters.status !== 'all' && product.status !== filters.status) {
          return false;
        }

        // Mapping filter
        if (filters.mapping !== 'all' && product.mapping !== filters.mapping) {
          return false;
        }

        // Stock filter
        if (filters.stock !== 'all') {
          switch (filters.stock) {
            case 'in-stock':
              if (product.stock <= 0) return false;
              break;
            case 'out-of-stock':
              if (product.stock > 0) return false;
              break;
            case 'low-stock':
              if (product.stock >= 10 || product.stock === 0) return false;
              break;
          }
        }

        return true;
      });
    }

    // Initialize all event listeners
    function initializeEventListeners() {
      // Platform selection
      document.querySelectorAll('.platform-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');

          currentPlatform = btn.dataset.platform;
          products = [...productsData[currentPlatform]];
          renderProducts();
          showToast(`Platform switched to: ${capitalizeFirstLetter(currentPlatform)}`);
        });
      });

      // Search functionality
      const searchInput = document.getElementById('searchInput');
      let searchTimeout;
      searchInput.addEventListener('input', function () {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          filters.search = this.value.trim();
          renderProducts();
        }, 300);
      });

      // Filter submenu options
      document.querySelectorAll('.filter-submenu-option').forEach(option => {
        option.addEventListener('click', function (e) {
          e.stopPropagation();

          const filterType = this.dataset.filter;
          const value = this.dataset.value;

          // Update filter state
          filters[filterType] = value;

          // Update UI
          updateFilterUI();

          // Apply filters
          renderProducts();
          renderActiveFilters();

          // Close dropdown on mobile
          if (window.innerWidth <= 768) {
            document.getElementById('filterDropdown').style.display = 'none';
          }

          showToast(`Filter applied: ${filterType} = ${value}`);
        });
      });

      // Bulk Actions
      const bulkActionsBtn = document.getElementById('bulkActionsBtn');
      const bulkDropdown = document.getElementById('bulkDropdown');

      bulkActionsBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        bulkDropdown.classList.toggle('show');
      });

      document.addEventListener('click', (e) => {
        if (!bulkActionsBtn.contains(e.target) && !bulkDropdown.contains(e.target)) {
          bulkDropdown.classList.remove('show');
        }
      });

      // Select all checkbox
      const selectAllCheckbox = document.getElementById('select-all');
      selectAllCheckbox.addEventListener('change', function () {
        const checkboxes = document.querySelectorAll('.product-checkbox:not(:disabled)');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });

      // Refresh button
      document.getElementById('refreshBtn').addEventListener('click', function () {
        const refreshIcon = this.querySelector('i');
        refreshIcon.style.transition = 'transform 0.5s';
        refreshIcon.style.transform = 'rotate(360deg)';

        showToast('Refreshing data...');

        setTimeout(() => {
          refreshIcon.style.transform = 'rotate(0deg)';
          products = [...productsData[currentPlatform]];
          renderProducts();
          showToast('Data refreshed successfully!');
        }, 1000);
      });

      // Bulk Actions Functionality
      document.querySelectorAll('.bulk-option').forEach(option => {
        option.addEventListener('click', function () {
          const action = this.dataset.action;
          const selectedProducts = getSelectedProducts();

          if (selectedProducts.length === 0) {
            showToast('Please select at least one product first!', 'warning');
            bulkDropdown.classList.remove('show');
            return;
          }

          bulkDropdown.classList.remove('show');

          switch (action) {
            case 'set-active':
              bulkSetStatus(selectedProducts, 'active');
              break;
            case 'set-pending':
              bulkSetStatus(selectedProducts, 'pending');
              break;
            case 'set-private':
              bulkSetStatus(selectedProducts, 'private');
              break;
            case 'set-rejected':
              bulkSetStatus(selectedProducts, 'rejected');
              break;
            case 'delete':
              bulkDeleteProducts(selectedProducts);
              break;
          }
        });
      });
    }

    // Initialize image upload functionality
    function initializeImageUpload() {
      const imageUploadModal = document.getElementById('imageUploadModal');
      const imageUploadInput = document.getElementById('imageUploadInput');
      const imagePreview = document.getElementById('imagePreview');
      const uploadPlaceholder = document.getElementById('uploadPlaceholder');
      const uploadImageBtn = document.getElementById('uploadImage');
      const cancelUploadBtn = document.getElementById('cancelUpload');
      const closeModalBtn = document.getElementById('closeModal');

      // Close modal functions
      closeModalBtn.addEventListener('click', closeUploadModal);
      cancelUploadBtn.addEventListener('click', closeUploadModal);

      // Close modal when clicking outside the content
      imageUploadModal.addEventListener('click', function (e) {
        if (e.target === imageUploadModal) {
          closeUploadModal();
        }
      });

      // Trigger file input when clicking on preview container
      document.getElementById('imagePreviewContainer').addEventListener('click', function () {
        imageUploadInput.click();
      });

      // Handle file selection
      imageUploadInput.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            imagePreview.src = e.target.result;
            imagePreview.style.display = 'block';
            uploadPlaceholder.style.display = 'none';
          };
          reader.readAsDataURL(file);
        }
      });

      // Handle image upload
      uploadImageBtn.addEventListener('click', function () {
        if (imagePreview.src && currentProductId && currentVariantId) {
          const product = products.find(p => p.id == currentProductId);
          const variant = product.variants.find(v => v.id == currentVariantId);

          if (variant) {
            variant.image = imagePreview.src;

            // If this is the FIRST variant, update product thumbnail
            if (product.variants.length && product.variants[0].id == currentVariantId) {
              product.image = imagePreview.src;
            }

            renderProducts();
            showToast('Image uploaded successfully!');
            closeUploadModal();
          }
        } else {
          showToast('Please select an image first!', 'warning');
        }
      });
    }

    // Attach image upload listeners to buttons
    function attachImageUploadListeners() {
      document.querySelectorAll('.upload-image-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const variantId = this.dataset.variantId;

          openImageUploadModal(productId, variantId);
        });
      });
    }

    function openImageUploadModal(productId, variantId) {
      currentProductId = parseInt(productId);
      currentVariantId = parseInt(variantId);
      const modal = document.getElementById('imageUploadModal');
      modal.classList.add('show');
      resetUploadModal();
    }

    function closeUploadModal() {
      const modal = document.getElementById('imageUploadModal');
      modal.classList.remove('show');
      resetUploadModal();
    }

    function resetUploadModal() {
      const imagePreview = document.getElementById('imagePreview');
      const uploadPlaceholder = document.getElementById('uploadPlaceholder');
      const imageUploadInput = document.getElementById('imageUploadInput');

      imagePreview.style.display = 'none';
      uploadPlaceholder.style.display = 'block';
      imagePreview.src = '';
      imageUploadInput.value = '';
    }

    // Attach event listeners to product rows
    function attachProductRowListeners() {
      // Expand/collapse product rows
      document.querySelectorAll('.product-row').forEach(row => {
        row.addEventListener('click', (e) => {
          if (e.target.type === 'checkbox' ||
            e.target.closest('.action-btn-icon') ||
            e.target.closest('.checkbox-container')) {
            return;
          }

          const productId = row.dataset.productId;
          const variantSection = document.getElementById(`variant-section-${productId}`);
          const arrowIcon = row.querySelector('.arrow-icon');

          // Close other expanded sections
          document.querySelectorAll('.expanded-variant-section').forEach(section => {
            if (section !== variantSection) {
              section.classList.remove('show');
            }
          });

          document.querySelectorAll('.product-row').forEach(otherRow => {
            if (otherRow !== row) {
              otherRow.classList.remove('expanded');
            }
          });

          // Toggle current section
          row.classList.toggle('expanded');
          if (row.classList.contains('expanded')) {
            variantSection.classList.add('show');
            arrowIcon.style.transform = 'rotate(90deg)';
          } else {
            variantSection.classList.remove('show');
            arrowIcon.style.transform = 'rotate(0deg)';
          }
        });
      });

      // Copy link buttons
      document.querySelectorAll('.copy-link').forEach(button => {
        button.addEventListener('click', async function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const product = products.find(p => p.id == productId);

          // Create a dummy URL (in real app, this would be the actual product URL)
          const productUrl = `https://${currentPlatform}.com/products/${productId}`;

          try {
            await navigator.clipboard.writeText(productUrl);
            showToast('Product link copied to clipboard!');
          } catch (err) {
            showToast('Failed to copy link', 'error');
          }
        });
      });

      // Delete product buttons
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const product = products.find(p => p.id == productId);

          if (confirm(`Are you sure you want to delete "${product.title}"? This action cannot be undone.`)) {
            products = products.filter(p => p.id != productId);
            renderProducts();
            showToast(`Product "${product.title}" deleted successfully`);
          }
        });
      });
    }

    // Attach event listeners to variant elements
    function attachVariantListeners() {
      // Bulk variant actions
      document.querySelectorAll('.sync-all-variants-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          showToast(`Syncing all variants for product ${productId}...`);

          // Simulate API call
          setTimeout(() => {
            showToast('All variants synced successfully!');
          }, 1500);
        });
      });

      document.querySelectorAll('.map-all-variants-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const product = products.find(p => p.id == productId);

          if (confirm(`Map all unmapped variants for "${product.title}"?`)) {
            product.variants.forEach(variant => {
              if (variant.mapping === 'unmapped') {
                variant.mapping = 'mapped';
              }
            });

            // Update product mapping status if all variants are mapped
            if (product.variants.every(v => v.mapping === 'mapped')) {
              product.mapping = 'mapped';
            }

            renderProducts();
            showToast(`${product.variants.length} variants have been mapped successfully!`);
          }
        });
      });

      document.querySelectorAll('.save-variants-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const product = products.find(p => p.id == productId);

          // Collect all variant data from inputs
          const skuInputs = document.querySelectorAll(`.sku-input[data-product-id="${productId}"]`);
          const weightInputs = document.querySelectorAll(`.weight-input[data-product-id="${productId}"]`);
          const priceInputs = document.querySelectorAll(`.price-input[data-product-id="${productId}"]`);
          const quantityInputs = document.querySelectorAll(`.quantity-input[data-product-id="${productId}"]`);

          skuInputs.forEach((input, index) => {
            product.variants[index].sku = input.value;
          });

          weightInputs.forEach((input, index) => {
            product.variants[index].weight = input.value;
          });

          priceInputs.forEach((input, index) => {
            product.variants[index].price = input.value;
          });

          quantityInputs.forEach((input, index) => {
            product.variants[index].quantity = parseInt(input.value) || 0;
          });

          // Update total stock
          product.stock = product.variants.reduce((total, variant) => total + variant.quantity, 0);

          showToast('Variant changes saved successfully!');
        });
      });

      // Individual variant actions
      document.querySelectorAll('.map-variant-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const variantId = this.dataset.variantId;
          const product = products.find(p => p.id == productId);
          const variant = product.variants.find(v => v.id == variantId);

          variant.mapping = variant.mapping === 'unmapped' ? 'mapped' : 'unmapped';

          // Update product mapping status
          if (product.variants.every(v => v.mapping === 'mapped')) {
            product.mapping = 'mapped';
          } else {
            product.mapping = 'unmapped';
          }

          renderProducts();
          showToast(`Variant "${variant.title}" ${variant.mapping === 'mapped' ? 'mapped' : 'unmapped'} successfully!`);
        });
      });

      document.querySelectorAll('.sync-variant-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const variantId = this.dataset.variantId;
          const product = products.find(p => p.id == productId);
          const variant = product.variants.find(v => v.id == variantId);

          showToast(`Syncing variant "${variant.title}"...`);

          // Simulate API call
          setTimeout(() => {
            showToast(`Variant "${variant.title}" synced successfully!`);
          }, 1000);
        });
      });

      document.querySelectorAll('.delete-variant-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const variantId = this.dataset.variantId;
          const product = products.find(p => p.id == productId);
          const variantIndex = product.variants.findIndex(v => v.id == variantId);

          if (variantIndex !== -1 && confirm(`Are you sure you want to delete this variant?`)) {
            const variant = product.variants[variantIndex];
            product.variants.splice(variantIndex, 1);

            // Update product stock
            product.stock = product.variants.reduce((total, v) => total + v.quantity, 0);

            renderProducts();
            showToast(`Variant deleted successfully!`);
          }
        });
      });

      // Add variant button
      document.querySelectorAll('.add-variant-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          const productId = this.dataset.productId;
          const product = products.find(p => p.id == productId);

          const newVariantId = product.variants.length > 0
            ? Math.max(...product.variants.map(v => v.id)) + 1
            : 1;

          product.variants.push({
            id: newVariantId,
            title: `New Variant ${newVariantId}`,
            description: "Add description here",
            image: "",
            sku: "",
            weight: "0 Pounds",
            price: "£0.00",
            quantity: 0,
            mapping: "unmapped"
          });

          renderProducts();
          showToast(`New variant added to "${product.title}"!`);
        });
      });
    }

    // Bulk Actions Helper Functions
    function getSelectedProducts() {
      const selected = [];
      document.querySelectorAll('.product-checkbox:checked').forEach(checkbox => {
        selected.push(parseInt(checkbox.dataset.productId));
      });
      return selected;
    }

    function bulkSetStatus(productIds, status) {
      productIds.forEach(productId => {
        const product = products.find(p => p.id == productId);
        if (product) {
          product.status = status;
        }
      });

      renderProducts();
      showToast(`${productIds.length} product(s) status updated to ${status}`);
    }

    function bulkDeleteProducts(productIds) {
      if (confirm(`Are you sure you want to delete ${productIds.length} selected product(s)? This action cannot be undone.`)) {
        products = products.filter(product => !productIds.includes(product.id));
        renderProducts();
        showToast(`${productIds.length} product(s) deleted successfully`);
      }
    }

    // Helper function
    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // Toast notification function
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');

      toastMessage.textContent = message;
      toast.className = 'toast';
      toast.classList.add(type);

      setTimeout(() => {
        toast.classList.add('show');
      }, 10);

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
  </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Sync - Vendor Management</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --warning: #f72585;
      --danger: #f72585;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --border-radius: 10px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f5f7fb;
      color: var(--dark);
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      width: 100%;
      margin: 0 auto;
      padding: 20px;
    }

    /* Page Header */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      background-color: white;
      padding: 20px 30px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--dark);
    }

    .back-btn {
      background-color: var(--light);
      color: var(--dark);
      border: none;
      padding: 12px 24px;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      text-decoration: none;
    }

    .back-btn:hover {
      background-color: var(--light-gray);
      transform: translateY(-2px);
    }

    /* Vendor Info Card */
    .vendor-info-card {
      background-color: white;
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .vendor-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #4361ee;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 32px;
      font-weight: 700;
    }

    .vendor-details h3 {
      font-size: 24px;
      margin-bottom: 5px;
      color: var(--dark);
    }

    .vendor-details p {
      color: var(--gray);
      margin-bottom: 8px;
    }

    .vendor-stats {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-label {
      font-size: 14px;
      color: var(--gray);
    }

    /* Sync Settings Container */
    .sync-settings-container {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    /* Sync Section */
    .sync-section {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 30px;
      box-shadow: var(--box-shadow);
    }

    .sync-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--light-gray);
    }

    .sync-title {
      font-size: 22px;
      font-weight: 600;
      color: var(--dark);
    }

    .sync-status {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sync-status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: var(--success);
    }

    .sync-status-indicator.error {
      background-color: var(--danger);
    }

    .sync-status-indicator.warning {
      background-color: var(--warning);
    }

    .sync-status-text {
      font-size: 14px;
      color: var(--gray);
    }

    /* Sync Options Grid */
    .sync-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 25px;
    }

    .sync-option {
      background-color: var(--light);
      border-radius: var(--border-radius);
      padding: 25px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .sync-option-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--dark);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sync-controls {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Sync Toggle */
    .sync-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .sync-toggle:last-child {
      border-bottom: none;
    }

    .toggle-label {
      font-weight: 500;
      color: var(--dark);
      font-size: 15px;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: var(--transition);
      border-radius: 34px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: var(--transition);
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--primary);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }

    /* Sync Frequency */
    .sync-frequency {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .frequency-label {
      font-weight: 500;
      color: var(--dark);
      font-size: 15px;
    }

    .frequency-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .frequency-option {
      padding: 10px 18px;
      border: 1px solid var(--light-gray);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
      background-color: white;
    }

    .frequency-option:hover {
      border-color: var(--primary);
      background-color: rgba(67, 97, 238, 0.1);
    }

    .frequency-option.active {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Sync Info Box */
    .sync-info {
      background-color: var(--light);
      border-radius: var(--border-radius);
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .last-sync {
      font-size: 15px;
      color: var(--gray);
    }

    .last-sync-time {
      font-weight: 600;
      color: var(--dark);
    }

    .sync-stats {
      display: flex;
      gap: 20px;
    }

    .stat-box {
      background-color: white;
      padding: 10px 20px;
      border-radius: var(--border-radius);
      text-align: center;
      min-width: 120px;
    }

    .stat-box-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-box-label {
      font-size: 13px;
      color: var(--gray);
      margin-top: 5px;
    }

    /* Sync Actions */
    .sync-actions {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .sync-now-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }

    .sync-now-btn:hover {
      background-color: var(--secondary);
      transform: translateY(-2px);
    }

    .save-settings-btn {
      background-color: var(--success);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }

    .save-settings-btn:hover {
      background-color: #3aa9d0;
      transform: translateY(-2px);
    }

    /* Sync Error Logs */
    .sync-errors {
      margin-top: 25px;
    }

    .sync-errors-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--danger);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .error-log {
      background-color: #fff5f5;
      border-radius: var(--border-radius);
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-size: 14px;
      color: #721c24;
      border: 1px solid #f8d7da;
    }

    .error-entry {
      padding: 12px 0;
      border-bottom: 1px solid rgba(220, 53, 69, 0.1);
    }

    .error-entry:last-child {
      border-bottom: none;
    }

    .error-time {
      color: var(--gray);
      font-size: 13px;
      margin-bottom: 5px;
    }

    .error-message {
      font-weight: 500;
    }

    /* Sync Logs Section */
    .sync-logs-section {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 30px;
      box-shadow: var(--box-shadow);
      margin-top: 30px;
    }

    .logs-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--light-gray);
    }

    .logs-title {
      font-size: 22px;
      font-weight: 600;
      color: var(--dark);
    }

    .logs-count {
      font-size: 14px;
      color: var(--gray);
    }

    /* Sync Logs Table */
    .logs-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    .logs-table th,
    .logs-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--light-gray);
    }

    .logs-table th {
      font-weight: 600;
      color: var(--gray);
      background-color: #f8f9fa;
    }

    .log-status {
      padding: 5px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    .log-status.success {
      background-color: rgba(40, 167, 69, 0.1);
      color: #28a745;
    }

    .log-status.error {
      background-color: rgba(220, 53, 69, 0.1);
      color: #dc3545;
    }

    .log-status.pending {
      background-color: rgba(255, 193, 7, 0.1);
      color: #ffc107;
    }

    /* Platform-specific styling */
    .platform-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      min-width: 100px;
    }

    .platform-shopify {
      background-color: rgba(95, 189, 125, 0.1);
      color: #5fbd7d;
    }

    .platform-woo {
      background-color: rgba(123, 104, 238, 0.1);
      color: #7b68ee;
    }

    .platform-wix {
      background-color: rgba(0, 196, 204, 0.1);
      color: #00c4cc;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: var(--border-radius);
      color: white;
      font-weight: 600;
      z-index: 3000;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--box-shadow);
      animation: slideInRight 0.3s ease;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success {
      background-color: var(--success);
    }

    .toast.error {
      background-color: var(--danger);
    }

    .toast.info {
      background-color: var(--primary);
    }

    .toast.warning {
      background-color: var(--warning);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .vendor-info-card {
        flex-direction: column;
        text-align: center;
      }

      .vendor-stats {
        justify-content: center;
      }

      .sync-options {
        grid-template-columns: 1fr;
      }

      .sync-info {
        flex-direction: column;
        align-items: flex-start;
      }

      .sync-stats {
        width: 100%;
        justify-content: space-between;
      }

      .sync-actions {
        flex-direction: column;
      }

      .sync-actions button {
        width: 100%;
      }

      .logs-table {
        display: block;
        overflow-x: auto;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 10px;
      }

      .page-header,
      .vendor-info-card,
      .sync-section {
        padding: 20px;
      }

      .sync-option {
        padding: 20px;
      }

      .frequency-options {
        flex-direction: column;
      }

      .frequency-option {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Product Sync Settings</h1>
      <a href="vendor-management.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Vendors
      </a>
    </div>

    <!-- Vendor Info Card -->
    <div class="vendor-info-card" id="vendorInfoCard">
      <!-- Vendor info will be loaded by JavaScript -->
    </div>

    <!-- Product Sync Section -->
    <div class="sync-settings-container">
      <div class="sync-section">
        <div class="sync-header">
          <h3 class="sync-title">Product Sync Settings</h3>
          <div class="sync-status">
            <div class="sync-status-indicator" id="productSyncStatus"></div>
            <span class="sync-status-text" id="productSyncStatusText">Loading...</span>
          </div>
        </div>

        <!-- Sync Frequency -->
        <div class="sync-frequency" style="margin-bottom: 25px;">
          <div class="frequency-label">Sync Frequency</div>
          <div class="frequency-options" id="productSyncMode">
            <div class="frequency-option active" data-value="realtime">Real-time</div>
            <div class="frequency-option" data-value="scheduled">Scheduled</div>
            <div class="frequency-option" data-value="manual">Manual Only</div>
          </div>
        </div>

        <div class="sync-options">
          <div class="sync-option">
            <h4 class="sync-option-title">Sync Controls</h4>
            <div class="sync-controls">
              <div class="sync-toggle">
                <span class="toggle-label">Inventory Sync</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="inventorySyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="sync-toggle">
                <span class="toggle-label">Price Sync</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="priceSyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="sync-toggle">
                <span class="toggle-label">Image Sync</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="imageSyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="sync-toggle">
                <span class="toggle-label">Description Sync</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="descriptionSyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>

          <div class="sync-option">
            <h4 class="sync-option-title">Advanced Settings</h4>
            <div class="sync-controls">
              <div class="sync-toggle">
                <span class="toggle-label">Sync Product Variants</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="variantsSyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="sync-toggle">
                <span class="toggle-label">Sync Out-of-Stock Products</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="outOfStockSyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="sync-toggle">
                <span class="toggle-label">Auto-create Categories</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="categoriesSyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="sync-toggle">
                <span class="toggle-label">Sync Product Reviews</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="reviewsSyncToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="sync-info">
          <div class="last-sync">
            Last product sync:
            <span class="last-sync-time" id="lastProductSync">Loading...</span>
          </div>
          <div class="sync-stats">
            <div class="stat-box">
              <div class="stat-box-value" id="totalProducts">0</div>
              <div class="stat-box-label">Total Products</div>
            </div>
            <div class="stat-box">
              <div class="stat-box-value" id="syncedProducts">0</div>
              <div class="stat-box-label">Synced</div>
            </div>
            <div class="stat-box">
              <div class="stat-box-value" id="failedProducts">0</div>
              <div class="stat-box-label">Failed</div>
            </div>
            <div class="stat-box">
              <div class="stat-box-value" id="pendingProducts">0</div>
              <div class="stat-box-label">Pending</div>
            </div>
          </div>
        </div>

        <div class="sync-actions">
          <button class="sync-now-btn" id="productSyncNow">
            <i class="fas fa-sync-alt"></i> Sync Products Now
          </button>
          <button class="save-settings-btn" id="saveProductSettings">
            <i class="fas fa-save"></i> Save Settings
          </button>
        </div>
      </div>

      <!-- Sync Logs Section -->
      <div class="sync-logs-section">
        <div class="logs-header">
          <h3 class="logs-title">Sync Logs</h3>
          <span class="logs-count" id="logsCount">0 logs</span>
        </div>
        <table class="logs-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Type</th>
              <th>Status</th>
              <th>Items</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody id="syncLogsTable">
            <!-- Sync logs will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toastNotification" style="display: none;">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage">Action completed successfully!</span>
  </div>

  <script>
    // Get vendor ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const vendorId = urlParams.get("id");

    // Global variables
    let currentVendor = null;
    let vendorsData = [];

    // Platform display names
    const platformNames = {
      shopify: "Shopify",
      woo: "WooCommerce",
      wix: "Wix",
    };

    // Country data
    const countries = {
      us: { name: "United States", flag: "üá∫üá∏" },
      uk: { name: "United Kingdom", flag: "üá¨üáß" },
      ca: { name: "Canada", flag: "üá®üá¶" },
      au: { name: "Australia", flag: "üá¶üá∫" },
      de: { name: "Germany", flag: "üá©üá™" },
      fr: { name: "France", flag: "üá´üá∑" },
    };

    // Initialize page
    document.addEventListener("DOMContentLoaded", async function () {
      await loadVendorData();
      if (currentVendor) {
        loadVendorInfo();
        initializeSyncSettings();
        loadSyncLogs();
        attachEventListeners();
      } else {
        showToast("Vendor not found!", "error");
        setTimeout(() => {
          window.location.href = "vendor-management.html";
        }, 2000);
      }
    });

    // Load vendor data from localStorage
    async function loadVendorData() {
      try {
        // Get all vendors from localStorage
        const storedVendors = localStorage.getItem('vendorsData');
        if (storedVendors) {
          vendorsData = JSON.parse(storedVendors);
          
          // Find the specific vendor by ID
          const vendor = vendorsData.find(v => v.id == vendorId);
          
          if (vendor) {
            currentVendor = vendor;
            
            // Ensure vendor has sync settings
            if (!currentVendor.syncSettings) {
              currentVendor.syncSettings = getDefaultSyncSettings();
            }
            
            // Ensure vendor has sync stats
            if (!currentVendor.syncStats) {
              currentVendor.syncStats = getDefaultSyncStats();
            }
            
            // Ensure vendor has sync logs
            if (!currentVendor.syncLogs) {
              currentVendor.syncLogs = getDefaultSyncLogs();
            }
            
            // Save updated vendor data
            saveVendorData();
            return true;
          }
        }
        return false;
      } catch (error) {
        console.error("Error loading vendor data:", error);
        return false;
      }
    }

    // Get default sync settings
    function getDefaultSyncSettings() {
      return {
        productSyncMode: "realtime",
        inventorySync: true,
        priceSync: true,
        imageSync: true,
        descriptionSync: true,
        variantsSync: true,
        outOfStockSync: true,
        categoriesSync: true,
        reviewsSync: false,
      };
    }

    // Get default sync stats
    function getDefaultSyncStats() {
      return {
        total: currentVendor?.products || 0,
        synced: Math.floor((currentVendor?.products || 0) * 0.9),
        failed: Math.floor((currentVendor?.products || 0) * 0.05),
        pending: Math.floor((currentVendor?.products || 0) * 0.05),
        lastSync: new Date().toISOString(),
      };
    }

    // Get default sync logs
    function getDefaultSyncLogs() {
      const now = new Date();
      return [
        {
          id: Date.now(),
          time: new Date(now.getTime() - 2 * 60 * 60 * 1000).toISOString(),
          type: "Product Sync",
          status: "success",
          items: `${Math.floor(currentVendor?.products * 0.8) || 0} products`,
          details: "Initial product sync completed",
        },
        {
          id: Date.now() - 1,
          time: new Date(now.getTime() - 4 * 60 * 60 * 1000).toISOString(),
          type: "Settings Update",
          status: "success",
          items: "Sync settings",
          details: "Default sync settings applied",
        },
      ];
    }

    // Save vendor data to localStorage
    function saveVendorData() {
      try {
        // Update the vendor in the vendors array
        const index = vendorsData.findIndex(v => v.id == currentVendor.id);
        if (index !== -1) {
          vendorsData[index] = currentVendor;
          localStorage.setItem('vendorsData', JSON.stringify(vendorsData));
        }
      } catch (error) {
        console.error("Error saving vendor data:", error);
      }
    }

    // Load vendor information
    function loadVendorInfo() {
      if (!currentVendor) return;

      const vendorInfoCard = document.getElementById("vendorInfoCard");
      const stats = currentVendor.syncStats || getDefaultSyncStats();

      vendorInfoCard.innerHTML = `
        <div class="vendor-avatar" style="background-color: ${currentVendor.avatarColor || '#4361ee'}">
          ${currentVendor.name.charAt(0)}
        </div>
        <div class="vendor-details">
          <h3>${currentVendor.name}</h3>
          <p>${currentVendor.email}</p>
          <p>
            <strong>Platform:</strong> 
            <span class="platform-badge platform-${currentVendor.platform}">
              ${platformNames[currentVendor.platform] || currentVendor.platform}
            </span>
          </p>
          <p>
            <strong>Country:</strong> 
            <span class="country-flag">
              ${countries[currentVendor.country]?.flag || "üåê"}
              ${countries[currentVendor.country]?.name || currentVendor.country}
            </span>
          </p>
          <div class="vendor-stats">
            <div class="stat-item">
              <div class="stat-value">${stats.total}</div>
              <div class="stat-label">Total Products</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" style="color: #28a745;">${stats.synced}</div>
              <div class="stat-label">Synced</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" style="color: #dc3545;">${stats.failed}</div>
              <div class="stat-label">Failed</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" style="color: #ffc107;">${stats.pending}</div>
              <div class="stat-label">Pending</div>
            </div>
          </div>
        </div>
      `;

      // Update product stats
      document.getElementById("totalProducts").textContent = stats.total;
      document.getElementById("syncedProducts").textContent = stats.synced;
      document.getElementById("failedProducts").textContent = stats.failed;
      document.getElementById("pendingProducts").textContent = stats.pending;
      document.getElementById("lastProductSync").textContent = formatTime(stats.lastSync);
    }

    // Initialize sync settings
    function initializeSyncSettings() {
      if (!currentVendor || !currentVendor.syncSettings) return;

      const settings = currentVendor.syncSettings;

      // Set sync mode
      document.querySelectorAll("#productSyncMode .frequency-option").forEach((option) => {
        if (option.dataset.value === settings.productSyncMode) {
          option.classList.add("active");
        } else {
          option.classList.remove("active");
        }
      });

      // Set toggle switches
      document.getElementById("inventorySyncToggle").checked = settings.inventorySync;
      document.getElementById("priceSyncToggle").checked = settings.priceSync;
      document.getElementById("imageSyncToggle").checked = settings.imageSync;
      document.getElementById("descriptionSyncToggle").checked = settings.descriptionSync;
      document.getElementById("variantsSyncToggle").checked = settings.variantsSync;
      document.getElementById("outOfStockSyncToggle").checked = settings.outOfStockSync;
      document.getElementById("categoriesSyncToggle").checked = settings.categoriesSync;
      document.getElementById("reviewsSyncToggle").checked = settings.reviewsSync;

      // Update status display
      updateSyncStatusDisplay();
    }

    // Update sync status display
    function updateSyncStatusDisplay() {
      if (!currentVendor || !currentVendor.syncSettings) return;

      const mode = currentVendor.syncSettings.productSyncMode;
      const statusText = document.getElementById("productSyncStatusText");
      const statusIndicator = document.getElementById("productSyncStatus");

      switch (mode) {
        case "realtime":
          statusText.textContent = "Real-time sync active";
          statusIndicator.style.backgroundColor = "#4cc9f0";
          break;
        case "scheduled":
          statusText.textContent = "Scheduled sync (every 4 hours)";
          statusIndicator.style.backgroundColor = "#ffc107";
          break;
        case "manual":
          statusText.textContent = "Manual sync only";
          statusIndicator.style.backgroundColor = "#6c757d";
          break;
        default:
          statusText.textContent = "Sync status unknown";
          statusIndicator.style.backgroundColor = "#6c757d";
      }
    }

    // Load sync logs
    function loadSyncLogs() {
      if (!currentVendor) return;

      const syncLogsTable = document.getElementById("syncLogsTable");
      const logsCount = document.getElementById("logsCount");
      const logs = currentVendor.syncLogs || [];

      syncLogsTable.innerHTML = "";
      
      if (logs.length === 0) {
        syncLogsTable.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray);">
              <i class="fas fa-history" style="font-size: 32px; margin-bottom: 10px; display: block; color: #e9ecef;"></i>
              <p>No sync logs available</p>
            </td>
          </tr>
        `;
      } else {
        // Sort logs by time (newest first)
        logs.sort((a, b) => new Date(b.time) - new Date(a.time));
        
        // Display only the 10 most recent logs
        const recentLogs = logs.slice(0, 10);
        
        recentLogs.forEach((log) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${formatTime(log.time)}</td>
            <td>${log.type}</td>
            <td><span class="log-status ${log.status}">${log.status.charAt(0).toUpperCase() + log.status.slice(1)}</span></td>
            <td>${log.items}</td>
            <td>${log.details}</td>
          `;
          syncLogsTable.appendChild(row);
        });
      }

      logsCount.textContent = `${logs.length} logs`;
    }

    // Add sync log
    function addSyncLog(type, status, items, details) {
      if (!currentVendor) return;

      const log = {
        id: Date.now(),
        time: new Date().toISOString(),
        type,
        status,
        items,
        details,
      };

      // Initialize sync logs array if it doesn't exist
      if (!currentVendor.syncLogs) {
        currentVendor.syncLogs = [];
      }

      // Add log to beginning of array
      currentVendor.syncLogs.unshift(log);

      // Keep only the last 50 logs
      if (currentVendor.syncLogs.length > 50) {
        currentVendor.syncLogs = currentVendor.syncLogs.slice(0, 50);
      }

      // Save data
      saveVendorData();

      // Update UI
      loadSyncLogs();
    }

    // Attach event listeners
    function attachEventListeners() {
      // Sync mode selection
      document.querySelectorAll("#productSyncMode .frequency-option").forEach((option) => {
        option.addEventListener("click", function () {
          document.querySelectorAll("#productSyncMode .frequency-option").forEach((opt) => {
            opt.classList.remove("active");
          });
          this.classList.add("active");
          
          if (currentVendor) {
            currentVendor.syncSettings.productSyncMode = this.dataset.value;
            updateSyncStatusDisplay();
          }
        });
      });

      // Sync Now button
      document.getElementById("productSyncNow").addEventListener("click", async function () {
        await syncProducts();
      });

      // Save Settings button
      document.getElementById("saveProductSettings").addEventListener("click", function () {
        saveSyncSettings();
      });
    }

    // Sync products function
    async function syncProducts() {
      if (!currentVendor) return;

      const syncBtn = document.getElementById("productSyncNow");
      const originalText = syncBtn.innerHTML;

      // Disable button and show loading
      syncBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Syncing...';
      syncBtn.disabled = true;

      // Update status display
      document.getElementById("productSyncStatusText").textContent = "Syncing...";
      document.getElementById("productSyncStatus").style.backgroundColor = "#ffc107";

      try {
        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 2000));

        // Update sync stats
        const stats = currentVendor.syncStats || getDefaultSyncStats();
        
        // Simulate some changes
        const newSynced = Math.min(stats.total, stats.synced + Math.floor(Math.random() * 10) + 1);
        const newFailed = Math.max(0, stats.failed - Math.floor(Math.random() * 2));
        const newPending = stats.total - newSynced - newFailed;

        currentVendor.syncStats = {
          ...stats,
          synced: newSynced,
          failed: newFailed,
          pending: newPending,
          lastSync: new Date().toISOString(),
        };

        // Update vendor info in the main vendors list
        updateVendorInMainList();

        // Save data
        saveVendorData();

        // Update UI
        loadVendorInfo();
        updateSyncStatusDisplay();

        // Add sync log
        addSyncLog(
          "Product Sync",
          "success",
          `${newSynced - stats.synced} products`,
          "Products synced successfully"
        );

        // Show success message
        showToast("Product sync completed successfully!", "success");

      } catch (error) {
        console.error("Sync error:", error);
        
        // Add error log
        addSyncLog(
          "Product Sync",
          "error",
          "0 products",
          `Sync failed: ${error.message || "Unknown error"}`
        );

        // Show error message
        showToast("Sync failed. Please try again.", "error");
        
        // Update status to error
        document.getElementById("productSyncStatusText").textContent = "Sync failed";
        document.getElementById("productSyncStatus").style.backgroundColor = "#dc3545";
      } finally {
        // Restore button
        syncBtn.innerHTML = originalText;
        syncBtn.disabled = false;
      }
    }

    // Save sync settings
    function saveSyncSettings() {
      if (!currentVendor) return;

      const saveBtn = document.getElementById("saveProductSettings");
      const originalText = saveBtn.innerHTML;

      // Get current settings from UI
      const activeMode = document.querySelector("#productSyncMode .frequency-option.active");
      
      // Update sync settings
      currentVendor.syncSettings = {
        productSyncMode: activeMode ? activeMode.dataset.value : "realtime",
        inventorySync: document.getElementById("inventorySyncToggle").checked,
        priceSync: document.getElementById("priceSyncToggle").checked,
        imageSync: document.getElementById("imageSyncToggle").checked,
        descriptionSync: document.getElementById("descriptionSyncToggle").checked,
        variantsSync: document.getElementById("variantsSyncToggle").checked,
        outOfStockSync: document.getElementById("outOfStockSyncToggle").checked,
        categoriesSync: document.getElementById("categoriesSyncToggle").checked,
        reviewsSync: document.getElementById("reviewsSyncToggle").checked,
      };

      // Update vendor in main list
      updateVendorInMainList();

      // Save data
      saveVendorData();

      // Update status display
      updateSyncStatusDisplay();

      // Show saving state
      saveBtn.innerHTML = '<i class="fas fa-check"></i> Settings Saved';
      saveBtn.style.backgroundColor = "#28a745";

      // Add sync log
      addSyncLog(
        "Settings Update",
        "success",
        "Sync settings",
        "Settings updated successfully"
      );

      // Show notification
      showToast("Sync settings saved successfully!", "success");

      // Restore button after 2 seconds
      setTimeout(() => {
        saveBtn.innerHTML = originalText;
        saveBtn.style.backgroundColor = "";
      }, 2000);
    }

    // Update vendor in the main vendors list
    function updateVendorInMainList() {
      try {
        const allVendors = JSON.parse(localStorage.getItem('vendorsData') || '[]');
        const index = allVendors.findIndex(v => v.id == currentVendor.id);
        
        if (index !== -1) {
          // Update only the relevant fields to preserve other data
          allVendors[index] = {
            ...allVendors[index],
            syncSettings: currentVendor.syncSettings,
            syncStats: currentVendor.syncStats,
            syncLogs: currentVendor.syncLogs,
          };
          
          localStorage.setItem('vendorsData', JSON.stringify(allVendors));
        }
      } catch (error) {
        console.error("Error updating vendor in main list:", error);
      }
    }

    // Format time
    function formatTime(dateString) {
      try {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        if (diffMins < 1) return "Just now";
        if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? "s" : ""} ago`;
        if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? "s" : ""} ago`;

        return date.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      } catch (error) {
        return "Unknown time";
      }
    }

    // Show toast notification
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toastNotification');
      const toastMessage = document.getElementById('toastMessage');
      
      toastMessage.textContent = message;
      toast.className = `toast ${type}`;
      toast.style.display = 'flex';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }
  </script>
</body>
</html>